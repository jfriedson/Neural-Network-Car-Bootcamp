<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>Map "Maker" p2</title>
        <style type="text/css">
            * { margin: 0; padding: 0; }

            body, html { height: 100%; width: 100%; overflow: hidden; }

            body { background-color: #000000; }
        </style>
    </head>
    <body>
        <img id="trackpic" src="silverstone.png" style="display:none">
        <canvas id="canvas" width="160" height="90"></canvas>

        <script type="text/javascript">

            window.onload = function() {
                var track = [[0,0],[0,-279],[2,-294],[8,-310],[15,-320],[25,-329],[40,-336],[74,-347],[130,-358],[171,-362],[198,-365],[338,-359],[353,-361],[366,-363],[392,-373],[412,-382],[425,-385],[434,-384],[442,-381],[509,-353],[521,-349],[532,-350],[544,-351],[556,-355],[568,-363],[582,-372],[593,-378],[605,-380],[614,-380],[624,-379],[634,-374],[644,-367],[652,-357],[658,-347],[664,-339],[672,-315],[678,-306],[686,-293],[701,-281],[1076,-32],[1113,-2],[1131,17],[1141,34],[1143,41],[1145,58],[1143,70],[1137,85],[1126,99],[1114,108],[1097,115],[1065,126],[1038,141],[1012,159],[998,170],[985,182],[972,193],[964,196],[957,198],[907,228],[900,238],[899,248],[901,254],[914,272],[920,289],[915,299],[894,319],[868,333],[836,343],[821,342],[811,337],[561,111],[553,98],[550,87],[549,72],[551,61],[567,-8],[568,-23],[568,-41],[564,-61],[555,-82],[485,-187],[481,-195],[481,-202],[487,-212],[494,-217],[507,-219],[559,-230],[567,-234],[572,-243],[573,-251],[568,-259],[542,-275],[517,-284],[474,-292],[462,-294],[452,-293],[445,-289],[124,9],[113,24],[109,42],[110,63],[119,79],[130,85],[179,94],[191,99],[201,110],[205,121],[205,138],[200,149],[192,157],[178,165],[163,166],[148,160],[59,102],[31,72],[17,50],[4,18]];

                var path1 = [], path2 = [];

                var c = document.getElementById("canvas");
                var ctx = c.getContext("2d");
                var img = document.getElementById("trackpic");


                function calcPath() {
                    var p1str = "", p2str = "";

                    for (var i = 0; i < track.length-1; ++i) {
                        wall_dx = (track[i+1][0]-track[i][0]);
                        wall_dy = (track[i+1][1]-track[i][1]);
                        angle1 = Math.atan2(wall_dy, wall_dx);

                        if(angle1 >= -3.14159 && angle1 < -1.57079){
                            //path1.push([track[i][0]*1.05 - 10, track[i][1]*1.05 + 10]);
                            //path2.push([track[i][0]*.95 + 10, track[i][1]*.95 - 10]);
                            path1.push([track[i][0], track[i][1]]);
                            path2.push([track[i][0], track[i][1]]);
                        }
                        else if(angle1 >= -1.57079 && angle1 < 0){
                            path1.push([track[i][0]*1.05 - 10, track[i][1]*1.05 + 10]);
                            path2.push([track[i][0]*.95 + 10, track[i][1]*.95 - 10]);
                        }
                        else if(angle1 >= 0 && angle1 < 1.57079){
                            path1.push([track[i][0], track[i][1]]);
                            path2.push([track[i][0], track[i][1]]);
                        }
                        else{
                            path1.push([track[i][0], track[i][1]]);
                            path2.push([track[i][0], track[i][1]]);
                        }


                        //p1str += ("[" + path1[i][0] + "," + (path1[i][1]+100) + "],");
                        //p2str += ("[" + path2[i][0] + "," + (path2[i][1]+100) + "],");
                    }

                    console.log(p1str);
                    console.log(p2str);
                }

                calcPath();
                resize();


                function draw() {
                    var offset = {x : 50, y : 500};
                    ctx.drawImage(img, 0, 0);
                    ctx.strokeStyle = 'red';
                    ctx.lineWidth = 1;

                    ctx.beginPath();
                    ctx.moveTo(track[0][0]+offset.x, track[0][1]+offset.y);
                    for(var i = 1; i < track.length; ++i) {
                        ctx.lineTo(track[i][0]+offset.x, track[i][1]+offset.y);
                    }
                    ctx.closePath();
                    ctx.stroke();

                    ctx.strokeStyle = 'blue';
                    ctx.lineWidth = 1;

                    ctx.beginPath();
                    ctx.moveTo(path1[0][0]+offset.x, path1[0][1]+offset.y);
                    for(var i = 1; i < path1.length; ++i) {
                        ctx.lineTo(path1[i][0]+offset.x, path1[i][1]+offset.y);
                    }
                    ctx.closePath();
                    ctx.stroke();

                    ctx.strokeStyle = 'green';
                    ctx.lineWidth = 1;

                    ctx.beginPath();
                    ctx.moveTo(path2[0][0]+offset.x, path2[0][1]+offset.y);
                    for(var i = 1; i < path2.length; ++i) {
                        ctx.lineTo(path2[i][0]+offset.x, path2[i][1]+offset.y);
                    }
                    ctx.closePath();
                    ctx.stroke();
                }

                window.addEventListener('resize', resize);
                function resize() {
                    c.width = window.innerWidth;
                    c.height = window.innerHeight;
                    draw();
                }
            }
        </script>
    </body>
</html>